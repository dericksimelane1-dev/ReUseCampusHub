{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const MapView=()=>{const mapRef=useRef(null);const[items,setItems]=useState([]);const[mapLoaded,setMapLoaded]=useState(false);const[userLocation,setUserLocation]=useState(null);const[radius,setRadius]=useState(5);// Radius in km\nconst mapInstance=useRef(null);const markersRef=useRef([]);// Load Google Maps script\nuseEffect(()=>{const loadMapScript=()=>{const existingScript=document.getElementById('googleMaps');if(!existingScript){const apiKey='AIzaSyBKxhggv1a7Y3h8yR37nRKQfFZ4EI8TMOc';// Replace with your actual key\nconst script=document.createElement('script');script.src=\"https://maps.googleapis.com/maps/api/js?key=\".concat(apiKey);script.id='googleMaps';script.async=true;script.defer=true;script.onload=()=>setMapLoaded(true);document.head.appendChild(script);}else{setMapLoaded(true);}};loadMapScript();},[]);// Get current user's location\nuseEffect(()=>{if(navigator.geolocation){navigator.geolocation.getCurrentPosition(position=>{setUserLocation({lat:position.coords.latitude,lng:position.coords.longitude});},error=>{console.error('Error getting user location:',error);});}},[]);// Fetch items\nuseEffect(()=>{const fetchItems=async()=>{try{const response=await fetch('http://localhost:5000/api/items');const data=await response.json();setItems(data);}catch(error){console.error('Error fetching items:',error);}};fetchItems();},[]);// Haversine formula\nconst getDistance=(lat1,lng1,lat2,lng2)=>{const toRad=value=>value*Math.PI/180;const R=6371;const dLat=toRad(lat2-lat1);const dLng=toRad(lng2-lng1);const a=Math.sin(dLat/2)**2+Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLng/2)**2;const c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return R*c;};// Render map and markers\nuseEffect(()=>{if(mapLoaded&&mapRef.current&&userLocation){if(!mapInstance.current){mapInstance.current=new window.google.maps.Map(mapRef.current,{center:userLocation,zoom:14});}const map=mapInstance.current;// Clear previous markers\nmarkersRef.current.forEach(marker=>marker.setMap(null));markersRef.current=[];const bounds=new window.google.maps.LatLngBounds();// Add user marker\nconst userMarker=new window.google.maps.Marker({position:userLocation,map,title:'You are here',icon:{url:'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'}});markersRef.current.push(userMarker);bounds.extend(userLocation);// Add item markers\nitems.forEach(item=>{var _loc,_loc2;let loc=null;try{loc=JSON.parse(item.location);// location is a JSON string\n}catch(e){console.warn('Invalid location format for item:',item.id);}if((_loc=loc)!==null&&_loc!==void 0&&_loc.lat&&(_loc2=loc)!==null&&_loc2!==void 0&&_loc2.lng){const distance=getDistance(userLocation.lat,userLocation.lng,loc.lat,loc.lng);if(distance<=radius){const marker=new window.google.maps.Marker({position:{lat:loc.lat,lng:loc.lng},map,title:\"\".concat(item.title,\" (\").concat(distance.toFixed(1),\" km)\")});markersRef.current.push(marker);bounds.extend({lat:loc.lat,lng:loc.lng});}}});map.fitBounds(bounds);}},[mapLoaded,items,userLocation,radius]);return/*#__PURE__*/_jsxs(\"div\",{style:{height:'100vh',width:'100%',display:'flex',flexDirection:'column'},children:[/*#__PURE__*/_jsx(\"div\",{style:{padding:'10px',background:'#fff',zIndex:1},children:/*#__PURE__*/_jsxs(\"label\",{children:[\"Search Radius: \",radius,\" km\",/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:\"0.5\",max:\"20\",step:\"0.5\",value:radius,onChange:e=>setRadius(parseFloat(e.target.value)),style:{width:'100%'}})]})}),/*#__PURE__*/_jsx(\"div\",{ref:mapRef,style:{flexGrow:1}})]});};export default MapView;","map":{"version":3,"names":["React","useEffect","useRef","useState","jsx","_jsx","jsxs","_jsxs","MapView","mapRef","items","setItems","mapLoaded","setMapLoaded","userLocation","setUserLocation","radius","setRadius","mapInstance","markersRef","loadMapScript","existingScript","document","getElementById","apiKey","script","createElement","src","concat","id","async","defer","onload","head","appendChild","navigator","geolocation","getCurrentPosition","position","lat","coords","latitude","lng","longitude","error","console","fetchItems","response","fetch","data","json","getDistance","lat1","lng1","lat2","lng2","toRad","value","Math","PI","R","dLat","dLng","a","sin","cos","c","atan2","sqrt","current","window","google","maps","Map","center","zoom","map","forEach","marker","setMap","bounds","LatLngBounds","userMarker","Marker","title","icon","url","push","extend","item","_loc","_loc2","loc","JSON","parse","location","e","warn","distance","toFixed","fitBounds","style","height","width","display","flexDirection","children","padding","background","zIndex","type","min","max","step","onChange","parseFloat","target","ref","flexGrow"],"sources":["C:/Users/dericks.MIDMUNIC/Documents/ReUseCampusHub/client/src/components/MapView.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\n\r\nconst MapView = () => {\r\n  const mapRef = useRef(null);\r\n  const [items, setItems] = useState([]);\r\n  const [mapLoaded, setMapLoaded] = useState(false);\r\n  const [userLocation, setUserLocation] = useState(null);\r\n  const [radius, setRadius] = useState(5); // Radius in km\r\n  const mapInstance = useRef(null);\r\n  const markersRef = useRef([]);\r\n\r\n  // Load Google Maps script\r\n  useEffect(() => {\r\n    const loadMapScript = () => {\r\n      const existingScript = document.getElementById('googleMaps');\r\n      if (!existingScript) {\r\n        const apiKey = 'AIzaSyBKxhggv1a7Y3h8yR37nRKQfFZ4EI8TMOc'; // Replace with your actual key\r\n        const script = document.createElement('script');\r\n        script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}`;\r\n        script.id = 'googleMaps';\r\n        script.async = true;\r\n        script.defer = true;\r\n        script.onload = () => setMapLoaded(true);\r\n        document.head.appendChild(script);\r\n      } else {\r\n        setMapLoaded(true);\r\n      }\r\n    };\r\n    loadMapScript();\r\n  }, []);\r\n\r\n  // Get current user's location\r\n  useEffect(() => {\r\n    if (navigator.geolocation) {\r\n      navigator.geolocation.getCurrentPosition(\r\n        (position) => {\r\n          setUserLocation({\r\n            lat: position.coords.latitude,\r\n            lng: position.coords.longitude,\r\n          });\r\n        },\r\n        (error) => {\r\n          console.error('Error getting user location:', error);\r\n        }\r\n      );\r\n    }\r\n  }, []);\r\n\r\n  // Fetch items\r\n  useEffect(() => {\r\n    const fetchItems = async () => {\r\n      try {\r\n        const response = await fetch('http://localhost:5000/api/items');\r\n        const data = await response.json();\r\n        setItems(data);\r\n      } catch (error) {\r\n        console.error('Error fetching items:', error);\r\n      }\r\n    };\r\n    fetchItems();\r\n  }, []);\r\n\r\n  // Haversine formula\r\n  const getDistance = (lat1, lng1, lat2, lng2) => {\r\n    const toRad = (value) => (value * Math.PI) / 180;\r\n    const R = 6371;\r\n    const dLat = toRad(lat2 - lat1);\r\n    const dLng = toRad(lng2 - lng1);\r\n    const a =\r\n      Math.sin(dLat / 2) ** 2 +\r\n      Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLng / 2) ** 2;\r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n    return R * c;\r\n  };\r\n\r\n  // Render map and markers\r\n  useEffect(() => {\r\n    if (mapLoaded && mapRef.current && userLocation) {\r\n      if (!mapInstance.current) {\r\n        mapInstance.current = new window.google.maps.Map(mapRef.current, {\r\n          center: userLocation,\r\n          zoom: 14,\r\n        });\r\n      }\r\n\r\n      const map = mapInstance.current;\r\n\r\n      // Clear previous markers\r\n      markersRef.current.forEach((marker) => marker.setMap(null));\r\n      markersRef.current = [];\r\n\r\n      const bounds = new window.google.maps.LatLngBounds();\r\n\r\n      // Add user marker\r\n      const userMarker = new window.google.maps.Marker({\r\n        position: userLocation,\r\n        map,\r\n        title: 'You are here',\r\n        icon: {\r\n          url: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png',\r\n        },\r\n      });\r\n      markersRef.current.push(userMarker);\r\n      bounds.extend(userLocation);\r\n\r\n      // Add item markers\r\n      items.forEach((item) => {\r\n        let loc = null;\r\n        try {\r\n          loc = JSON.parse(item.location); // location is a JSON string\r\n        } catch (e) {\r\n          console.warn('Invalid location format for item:', item.id);\r\n        }\r\n\r\n        if (loc?.lat && loc?.lng) {\r\n          const distance = getDistance(userLocation.lat, userLocation.lng, loc.lat, loc.lng);\r\n          if (distance <= radius) {\r\n            const marker = new window.google.maps.Marker({\r\n              position: { lat: loc.lat, lng: loc.lng },\r\n              map,\r\n              title: `${item.title} (${distance.toFixed(1)} km)`,\r\n            });\r\n            markersRef.current.push(marker);\r\n            bounds.extend({ lat: loc.lat, lng: loc.lng });\r\n          }\r\n        }\r\n      });\r\n\r\n      map.fitBounds(bounds);\r\n    }\r\n  }, [mapLoaded, items, userLocation, radius]);\r\n\r\n  return (\r\n    <div style={{ height: '100vh', width: '100%', display: 'flex', flexDirection: 'column' }}>\r\n      <div style={{ padding: '10px', background: '#fff', zIndex: 1 }}>\r\n        <label>\r\n          Search Radius: {radius} km\r\n          <input\r\n            type=\"range\"\r\n            min=\"0.5\"\r\n            max=\"20\"\r\n            step=\"0.5\"\r\n            value={radius}\r\n            onChange={(e) => setRadius(parseFloat(e.target.value))}\r\n            style={{ width: '100%' }}\r\n          />\r\n        </label>\r\n      </div>\r\n      <div ref={mapRef} style={{ flexGrow: 1 }} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MapView;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}