{"ast":null,"code":"import React,{useEffect,useState}from'react';import{BrowserRouter as Router,Routes,Route,Navigate}from'react-router-dom';import{jwtDecode}from'jwt-decode';import Analysis from'./components/Analysis';import ManageUsers from'./components/ManageUsers';//import ExchangeTracking from './components/ExchangeStatus';\nimport ProtectedRoute from'./components/ProtectedRoute';import NavbarAdmin from'./components/NavbarAdmin';import ExchangeHistory from'./components/ExchangeHistory';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function AdminApp(){const[isAuthenticated,setIsAuthenticated]=useState(null);// null = loading\nconst[isAdmin,setIsAdmin]=useState(false);useEffect(()=>{const checkAuth=()=>{const token=localStorage.getItem('token');if(token==='admin-token'){setIsAuthenticated(true);setIsAdmin(true);}else if(token&&token.split('.').length===3){try{const decoded=jwtDecode(token);setIsAuthenticated(true);setIsAdmin(decoded.role==='admin');}catch(err){console.error('Invalid token:',err);setIsAuthenticated(false);}}else{setIsAuthenticated(false);}};checkAuth();window.addEventListener('storage',checkAuth);return()=>window.removeEventListener('storage',checkAuth);},[]);if(isAuthenticated===null){return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});// Wait until auth is checked\n}return/*#__PURE__*/_jsxs(Router,{children:[isAuthenticated&&isAdmin&&/*#__PURE__*/_jsx(NavbarAdmin,{}),/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/analysis\",element:/*#__PURE__*/_jsx(ProtectedRoute,{isAuthenticated:isAuthenticated&&isAdmin,children:/*#__PURE__*/_jsx(Analysis,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/ManageUsers\",element:/*#__PURE__*/_jsx(ProtectedRoute,{isAuthenticated:isAuthenticated&&isAdmin,children:/*#__PURE__*/_jsx(ManageUsers,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/ExchangeHistory\",element:/*#__PURE__*/_jsx(ProtectedRoute,{isAuthenticated:isAuthenticated&&isAdmin,children:/*#__PURE__*/_jsx(ExchangeHistory,{})})}),/*#__PURE__*/_jsx(Route,{path:\"*\",element:/*#__PURE__*/_jsx(Navigate,{to:isAuthenticated&&isAdmin?\"/analysis\":\"/login\"})})]})]});}export default AdminApp;","map":{"version":3,"names":["React","useEffect","useState","BrowserRouter","Router","Routes","Route","Navigate","jwtDecode","Analysis","ManageUsers","ProtectedRoute","NavbarAdmin","ExchangeHistory","jsx","_jsx","jsxs","_jsxs","AdminApp","isAuthenticated","setIsAuthenticated","isAdmin","setIsAdmin","checkAuth","token","localStorage","getItem","split","length","decoded","role","err","console","error","window","addEventListener","removeEventListener","children","path","element","to"],"sources":["C:/Users/dericks.MIDMUNIC/Documents/ReUseCampusHub/client/src/AdminApp.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';\r\nimport { jwtDecode } from 'jwt-decode';\r\n\r\nimport Analysis from './components/Analysis';\r\nimport ManageUsers from './components/ManageUsers';\r\n//import ExchangeTracking from './components/ExchangeStatus';\r\nimport ProtectedRoute from './components/ProtectedRoute';\r\nimport NavbarAdmin from './components/NavbarAdmin';\r\nimport ExchangeHistory from './components/ExchangeHistory';\r\n\r\nfunction AdminApp() {\r\n  const [isAuthenticated, setIsAuthenticated] = useState(null); // null = loading\r\n  const [isAdmin, setIsAdmin] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const checkAuth = () => {\r\n      const token = localStorage.getItem('token');\r\n      if (token === 'admin-token') {\r\n        setIsAuthenticated(true);\r\n        setIsAdmin(true);\r\n      } else if (token && token.split('.').length === 3) {\r\n        try {\r\n          const decoded = jwtDecode(token);\r\n          setIsAuthenticated(true);\r\n          setIsAdmin(decoded.role === 'admin');\r\n        } catch (err) {\r\n          console.error('Invalid token:', err);\r\n          setIsAuthenticated(false);\r\n        }\r\n      } else {\r\n        setIsAuthenticated(false);\r\n      }\r\n    };\r\n\r\n    checkAuth();\r\n    window.addEventListener('storage', checkAuth);\r\n    return () => window.removeEventListener('storage', checkAuth);\r\n  }, []);\r\n\r\n  if (isAuthenticated === null) {\r\n    return <div>Loading...</div>; // Wait until auth is checked\r\n  }\r\n\r\n  return (\r\n    <Router>\r\n      {(isAuthenticated && isAdmin) && <NavbarAdmin />}\r\n      <Routes>\r\n        <Route\r\n          path=\"/analysis\"\r\n          element={\r\n            <ProtectedRoute isAuthenticated={isAuthenticated && isAdmin}>\r\n              <Analysis />\r\n            </ProtectedRoute>\r\n          }\r\n        />\r\n        <Route\r\n          path=\"/ManageUsers\"\r\n          element={\r\n            <ProtectedRoute isAuthenticated={isAuthenticated && isAdmin}>\r\n              <ManageUsers />\r\n            </ProtectedRoute>\r\n          }\r\n        />\r\n        <Route\r\n          path=\"/ExchangeHistory\"\r\n          element={\r\n            <ProtectedRoute isAuthenticated={isAuthenticated && isAdmin}>\r\n              <ExchangeHistory />\r\n            </ProtectedRoute>\r\n          }\r\n        />\r\n        <Route\r\n          path=\"*\"\r\n          element={<Navigate to={isAuthenticated && isAdmin ? \"/analysis\" : \"/login\"} />}\r\n        />\r\n      </Routes>\r\n    </Router>\r\n  );\r\n}\r\n\r\nexport default AdminApp;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}